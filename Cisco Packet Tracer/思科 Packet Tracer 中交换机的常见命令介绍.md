# 思科 Packet Tracer 中交换机的常见命令介绍

[toc]

*主要参考自：思科CCNA1的在线课程第二章和教学课件*
 *版本：Cisco Packet Tracer 7.3.0*

# 配置方法

对于交换机的控制台，一般采用[命令行](https://so.csdn.net/so/search?q=命令行&spm=1001.2101.3001.7020)界面（command-line interface，**CLI**）的配置形式。不会直接用交换机来控制，用电脑来打开**终端 terminal**，使用 **console 配置线缆**连接交换机和PC机。
 其中控制台配置的通信标准通常是RS-232标准。
 因此通信距离短，配置只能在设备旁边完成，所以这种方式又被称为“本地配置”。

# 命令行界面 CLI

Packet Tracer 软件模拟的思科交换机均使用基于IOS命令集的CLI

## 命令结构

分层结构，将每个命令划分到不同的模式（mode）中以完成特殊的任务，不同的命令模式用不同的提示符表示。其中有四种模式：

- 用户登录交换机后，首先进入的是**用户EXEC模式**（user EXEC mode）命令提示符为`Switch>`，在该模式中只能执行一些简单的测试和查看命令。

- 在用户EXEC模式下输入 `enable` 命令即可进入**特权EXEC模式**（privileged EXEC mode），命令提示符为 `Switch#`，在该模式中可以执行复杂的测试操作和管理维护命令。

- 在特权EXEC模式下输入 `configure terminal` 命令即可进入**全局配置模式**（global configuration mode），命令提示符为`Switch(config)#`，交换机的所有配置操作均从全局配置模式开始。

- 许多不同的

  子配置模式

  。例如，要进入线路子配置模式，您可以使用 

  ```
  line
  ```

   命令后跟您要访问的管理线路类型和编号来实现。要退出子配置模式并返回全局配置模式，请使用 

  ```
  exit
  ```

   命令。   

  - 要从任何子配置模式切换到特权模式，请输入 `end` 命令或输入组合键 Ctrl+Z。
  - 还可以直接从一个子配置模式切换到另一个子配置模式。注意在选择接口后，命令提示符如何从 (config-line)# 改为 (config-if)#。

在每个模式中使用`exit`命令即可回退至上一级模式。

命令提示符中的`Switch`是思科交换机的缺省名称，可以使用全局配置模式中的 `hostname` 命令更改它。

# 基本 IOS 命令结构

常规命令语法为命令后接相应的关键字(操作系统中定义的具体参数)和参数(没有预定义；是由用户定义的值或变量)。
 输入包括关键字和参数在内的完整命令后，按 Enter 键将该命令提交给命令解释程序。
 对于参考文档：

| 约定       | 说明                                           |
| ---------- | ---------------------------------------------- |
| **粗体**   | 粗体文本表示您需要原样输入的命令和关键字       |
| *斜体*     | 斜体文本表示由您提供值的参数                   |
| [x]        | 方括号表示可选元素                             |
| {x}        | 大括号表示必需元素                             |
| [x{y \|z}] | 方括号中的大括号和垂直线表示可选元素中的填选顶 |

## 上下文相关帮助功能

快速找到每个命令模式中哪些命令可用，哪些命令以特定字符或字符组开头，以及哪些参数和关键字可用于特定命令。用法：

- 在命令后面输入空格和一个问号 `?`
- 直接在命令后面输入问号 `?`（不输入空格）

> 出现 `—More—` 表示输出还未结束，点击Space 则显示下一屏信息，点击return 则显示下一行信息。

# 热键和快捷方式

命令和关键字可缩写为可唯一确定该命令或关键字的最短字符数。

例如，`configure` 命令可缩写为 `conf`，因为 configure 是唯一一个以 conf 开头的命令。不能缩写为 con，因为以 con 开头的命令不止一个。

## 常用：

Tab 用于补全部分输入
 Ctrl -c 中止

注意：Delete 无法识别

# 设备名称

在配置网络设备时，第一步是配置唯一的设备名称或主机名。
 Cisco IOS 交换机的默认名称是“Switch”。

主机名要求：

> 以字母开头；不含空格；以字母或数字结尾；仅使用字母、数字和短划线；且长度少于 64 个字符。

注意：

- IOS 设备中所用的主机名会保留字母的大小写状态。因此，您可以象平常那样采用大写字母表示名称。这与大多数 Internet 命名方案不同，这些 Internet 命名方案不区分大小写字母。
- 要删除已配置的主机名并使交换机返回默认提示符，请使用 `no hostname` 全局配置命令。

配置主机名
 在特权 EXEC 模式下，输入 `configure terminal` 命令（缩写 `conf t`）访问全局配置模式。

# 安全访问

## 配置密码

要配置的最重要的密码是对特权 EXEC 模式的访问，使用 `enable secret password` 全局配置命令。
 要保护用户 EXEC 访问，必须配置控制台端口。

- 先使用 `line console 0` 全局配置命令进入线路控制台配置模式，其中 0 用于代表第一个（而且在大多数情况下是唯一的一个）控制台接口。
- 接下来，使用 **password 命令**指定用户 EXEC 模式密码。
- 最后，使用 **login 命令**启用用户 EXEC 访问。
   现在控制台访问需要输入密码，然后才能访问用户 EXEC 模式。

虚拟终端 (VTY) 线路支持对设备的远程访问。要保护为 SSH 和 Telnet 使用的 VTY 线路，请使用 line vty 0 15 全局配置命令进入线路 VTY 模式。

## [加密](https://so.csdn.net/so/search?q=加密&spm=1001.2101.3001.7020)密码

启动配置和运行配置文件以明文显示大多数密码。这会带来安全威胁，因为任何人如果访问这些文件，就可以看到这些密码。
 要加密密码，请使用 `service password-encryption` 全局配置命令。
 该命令对所有未加密的密码进行弱加密。
 注意：

- 这种加密仅适用于配置文件中的密码，而不适用于通过网络发送的密码。此命令的用途在于防止未经授权的人员查看配置文件中的密码。

使用 `show running-config` 命令验证密码现在是否已加密。

## 标语消息

尽管要求用户输入密码是防止未经授权的人员进入网络的有效方法，但同时必须向试图访问设备的人员声明仅授权人员才可访问设备。出于此目的，可向设备输出中加入一条标语。当控告某人侵入设备时，标语可在诉讼程序中起到重要作用。

使用 `banner motd # the message of the day #` 全局配置命令。

命令语法中的 `#` 称为定界符。它会在消息前后输入。定界符可以是未出现在消息中的任意字符。因此，经常使用 `#` 之类的字符。

命令执行完毕后，系统将向之后访问设备的所有用户显示该标语，直到登录成功为止。

# 交换机端口安全

持三种类型的安全MAC地址：

- 静态安全MAC地址：手动配置，存储在地址表和交换机的运行配置中。
- 动态安全MAC地址：动态学习，仅存储在地址表中，交换机重启时将被移除。
- 粘滞安全MAC地址：将动态学习的MAC地址保存到运行配置中。

根据出现违规时要采取的操作，可以将接口配置为以下三种违规模式之一：

- 保护

  ```
    当安全MAC地址的数量达到端口允许的限制时，带有未知源地址的帧将被丢弃，直至移除足够数量的安全MAC地址或增加允许的最大地址数。
  
    在此模式下，不会得到发生安全违规的通知。
  123
  ```

- 限制

  ```
    当安全MAC地址的数量达到端口允许的限制时，带有未知源地址的帧将被丢弃，直至移除足够数量的安全MAC地址或增加允许的最大地址数。
  
    在此模式下，会得到发生安全违规的通知，将有SNMP陷阱发出、syslog消息记入日志，以及违规计数器的计数增加。
  123
  ```

- 关闭

  ```
    默认模式。
  
    在此模式下，端口安全违规将造成接口立即变为错误禁用（error-disabled）状态，并关闭端口指示灯。
  
    该模式还会发送SNMP陷阱、将syslog消息记入日志，以及增加违规计数器的计数。
  12345
  ```

当安全端口处于错误禁用状态时，先输入 shutdown 、再输入 no shutdown 接口配置命令可使其脱离此状态

# 保存配置

## 保存运行配置文件

有两种系统文件用于存储设备配置：

- 启动配置 - 该文件存储在非易失性随机访问存储器 (NVRAM) 中，包含设备在启动或重启时将会使用的所有命令。设备断电后，NVRAM 中的内容不会丢失。
- 运行配置 - 该文件存储在随机访问存储器 (RAM) 中，反映当前配置。修改运行配置会立即影响思科设备的运行。RAM 是易失性存储器。如果设备断电或重新启动，则它会丢失所有内容。

可以从dir命令下看出两种非易失的文件。

使用 `show running-config` 特权 EXEC 模式命令查看运行配置文件。

如果设备断电或重新启动，所有未保存的配置更改都会丢失。

要将对运行配置所作的更改保存到启动配置文件中，请使用 `copy running-config startup-config` 特权 EXEC 模式命令。

## 将配置捕获到文本文件中

配置文件也可以保存并存档到文本文档中。这一系列步骤可确保获取当前配置文件的一份副本以供稍后编辑或重新使用。

例如，假定交换机已经配置，而且运行配置已经保存到设备上。

打开一个与交换机连接的终端仿真软件，比如 PuTTY 或 Tera Term。

在终端软件（比如 PuTTY 或 Tera Term）中启用日志记录，并指定名称和文件位置以保存日志文件。

在特权 EXEC 提示符下执行 `show running-config` 或 `show startup-config` 命令。终端窗口中显示的文本将保存到所选的文件中。

所创建的文本文件可用作设备当前实施方式的记录。在用于将保存的配置恢复到设备之前，可能需要对该文件进行编辑。要将配置文件恢复到设备中，请执行以下操作：

- 在设备上进入全局配置模式。
- 将文本文件复制并粘贴到与交换机相连的终端窗口中。

文件中的文本将作为 CLI 中的命令应用，并成为设备上的运行配置。这是手动配置设备的一种便利方法。

# 更改运行配置

如果对运行配置所作的更改未达到预期效果，而且运行配置文件尚未保存，您可以单独删除已更改的命令，以将设备恢复到之前的配置，或者使用 reload 特权 EXEC 模式命令重新加载设备，以恢复启动配置。

使用 reload 命令删除未保存的运行配置的缺点是，在一段很短的时间内设备将会离线，导致网络中断。

当开始重新加载时，IOS 会检测到发生更改的运行配置没有保存到启动配置中。

因此，它将显示一则提示消息，询问是否保存更改。要放弃更改，请输入 `n` 或 `no`。

或者，如果将不理想的更改保存到了启动配置中，则可能需要清除所有配置。这需要删除启动配置并重新启动设备。

使用 `erase startup-config` 特权 EXEC 模式命令可删除启动配置。在发出此命令后，交换机将提示您确认。按 Enter 键接受。

从 NVRAM 中删除启动配置后，请重新加载设备以从内存中清除当前的运行配置文件。

重新加载时，交换机将会加载设备出厂默认的启动配置。

# 地址方案

## IP 地址

使用 IP 地址，是设备能够相互查找并在 Internet 上建立端到端通信的主要方式。

网络中的每个终端设备都必须配置 IP 地址。

IPv4 地址的结构称为点分十进制记法，用 0 到 255 之间的四个十进制数字表示。IPv4 地址会分配给连接到网络的各个设备。

IPv4 子网掩码是将地址的网络部分与主机部分区分开来的 32 位值。子网掩码，与 IPv4 地址相结合，可用于确定设备属于哪个特定子网。

IP 地址可以分配给设备的物理端口和虚拟接口。虚拟接口表示设备没有关联任何物理硬件。

## Cisco上的交换机虚拟接口配置

要远程访问交换机，SVI 上必须配置 IP 地址和子网掩码。

要在交换机上配置 SVI，请使用 `interface vlan 1` 全局配置命令。Vlan 1 并不是一个实际物理接口，而是一个虚拟接口。

接下来，使用 **ip address 命令**分配 IPv4 地址。

最后，使用 **no shutdown 接口配置**命令启用虚拟接口。

在这些命令配置后，交换机即可使用所有 IPv4 要素进行网络通信。

# 配置并创建VLAN

VLAN的创建方法有两种：

- 在每台交换机上手动设置每个VLAN。一旦交换机数量多，就容易出现问题。
- 使用VLAN中继协议（VLAN Trunk Protocol，VTP）设置和管理整个域中的VLAN。

注意：

> - 必须在交换机开启VLAN特性的前提下创建VLAN。Cisco Catalyst 2900 XL交换机缺省即开启了VLAN特性，并且不能关闭。
> - VLAN 1 和VLAN 1002～1005是保留的VLAN，不能创建也不能删除。（可以show一下看到）
> - VLAN 1是交换机所有端口的缺省VLAN，同时也是默认的管理VLAN。

思科交换机的VLAN配置信息保存在Flash中的vlan.dat文件里，而不是与交换机的其他配置信息一起保存在配置文件 startup-config中 。

因此，删除 startup-config 文件并重启交换机后，原有的VLAN配置信息仍然生效。

所以，在创建VLAN之前务必在特权模式下使用dir命令检查是否存在 vlan.dat 文件。

如有，则必须使用delete命令删除该文件，并使用 **reload命令** 重启交换机，如不删除则会影响交换机的VLAN配置操作。

## 手动创建VLAN

手动设置在交换机上的VLAN仅在本交换机上有效。

如果一个VLAN中有多台交换机，则需要在每台交换机上手动设置该VLAN。

如果一台交换机连接了几个VLAN，就需要在该交换机上手动设置几个VLAN。

手动设置VLAN时，首先进入交换机CLI的VLAN配置模式，然后在该模式下设置VLAN。

| 命令                      | 描述                         |
| ------------------------- | ---------------------------- |
| **vlan** *vlan-id*        | 在配置模式下设置一个VLAN     |
| **no** **vlan** *vlan-id* | 在配置模式下删除一个VLAN     |
| **name** *vlan-name*      | 在VLAN配置模式下配置VLAN名   |
| **show** **vlan** [brief] | 在特权模式下显示所有VLAN信息 |

## 使用VTP创建VLAN

过程是：

- 在VTP域内的一台（或少量几台）交换机上手动设置VLAN信息；
- 这台交换机将携带这些VLAN信息的VTP帧通过中继链路（trunk link）上的本征VLAN（native VLAN）传递给VTP域内的其他交换机；
- 其他交换机从收到的VTP消息中自动学习已创建的VLAN。

主要命令

| 命令                                       | 描述                            |
| ------------------------------------------ | ------------------------------- |
| vtp mode {client \| server \| transparent} | 在特权模式下设置交换机的VTP模式 |
| vtp domain domain-name                     | 在特权模式下配置VTP域名         |
| vtp password password                      | 从特权模式下配置VTP域口令       |
| show vtp status                            | 在特权模式下显示VTP的设置信息   |

注意：

> - 思科交换机缺省开启了VTP功能，并处于VTP Server模式，没有提供开启或关闭VTP的命令。
> - VTP域名可手动设置在VTP Server或VTP Client交换机上。
> - 在设置VTP模式时，如果该交换机是第一个加入VTP域的交换机，通常将其设置为VTP Server。如果VTP域中已经有了其他交换机，则通常先将该交换机设置为VTP Client后再接入网络中，以免该交换机上错误的VLAN信息意外地传播到整个VTP域中。
> - 如果需要将该交换机设置为**VTP Server**，一般先将其设置为VTP Client，等它学到正确的VLAN信息之后，再将其模式改为VTP Server。
> - 如果交换机不与其它交换机共享VLAN信息，则将其设置为**VTP Transparent**。
> - 在使用VTP创建VLAN时，发布在VTP协议中的VLAN信息手动设置在VTP Server交换机上。VTP  Client交换机上无需手动设置VLAN，而是通过VTP自动获得VTP域内的VLAN信息。但是，如果交换机被设置成VTP  Transparent，则需在该交换机上手动设置VLAN。

# 设置端口模式并指派VLAN

## 中继端口

| 命令                                              | 描述                           |
| ------------------------------------------------- | ------------------------------ |
| **switchport mode trunk**                         | 将端口设置为中继模式           |
| **switchport trunk allowed vlan all**             | 将中继端口加入到所有VLAN中     |
| **switchport trunk native vlan** *vlan-id*        | 设置中继端口的本征VLAN         |
| **show interfaces** *interface-id* **switchport** | 查看交换机端口的模式及VLAN信息 |
| **show interfaces trunk**                         | 查看交换机的中继端口           |

注意：

> 思科交换机的VLAN中继端口缺省加入到所有VLAN中。

## 接入端口

交换机的接入端口只能连接VLAN非知晓设备（如普通的PC机）。

一个接入端口只能加入到一个已创建的VLAN中，并且只能收发无VLAN标记帧。

接入端口的配置

在接口配置模式中使用下面的命令将一个交换机端口设置成接入端口：

```cpp
switchport mode access
1
```

在接口配置模式中使用下面的命令将一个接入端口加入指定的VLAN中：

```cpp
switchport access vlan vlan-id
1
```

思科交换机的所有接口缺省都是VLAN 1中的接入端口。

# STP协议的配置

STP协议的主要配置内容包括：开启和关闭STP、配置交换机的优先级、配置端口路径开销、配置端口优先级、配置STP协议的一些定时器，等等。

其中，在交换机上设置交换机的优先级、端口路径开销和端口优先级都会引起网络生成树拓扑的重新计算。

在实际应用中，如果不存在物理的交换环路，则可关闭STP。

| 命令                                              | 描述                                |
| ------------------------------------------------- | ----------------------------------- |
| **spanning-tree vlan** *vlan-id* *priority value* | 在全局配置模式下设置交换机的优先级  |
| **show spanning-tree**                            | 查看交换机的STP协议运行情况         |
| **show spanning-tree vlan** *vlan-id*             | 查看交换机某个VLAN的STP协议运行情况 |

# 单臂路由

在路由器的全局配置模式中使用下面的命令创建一个子接口 Subinterface ，并进入子接口配置模式：

**interface** *type* *slot/port.subinterface-number*

- 参数值的范围是 1～4294967293。为了便于掌握 VLAN 与 IP 子网的对应，通常可以使用对应 VLAN 的 ID 值做为 subinterface-number。

子接口配置模式下使用 **encapsulation dot1q** *vlan-id* 命令指定该子接口的中继封装协议。（IEEE 802.1Q -英文缩写为dot1q）

每个 VLAN 所对应的 IP 信息必须设置在对应的子接口上。

在路由器的子接口配置模式下使用 **ip address** *ip-address mask* 命令设置该子接口的 IP 地址和掩码。

不断学习中，欢迎交流

